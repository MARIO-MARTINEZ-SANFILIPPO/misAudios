<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Reproductor de Audio para Estudiar</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script type="text/javascript">document.oncontextmenu = function(){return false;}</script>
    <!-- Iconos Phosphor -->
    <script src="https://unpkg.com/@phosphor-icons/web"></script>
    <style>
        .progress-bar-container:hover .progress-bar-thumb { opacity: 1; }
        input[type="file"] { display: none; }
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');
        body { font-family: 'Inter', sans-serif; }
        .playlist-item:hover { background-color: #1f2937; }
        .playlist-item.active { background-color: #374151; color: white; }
        .topic-btn { background-color: #374151; }
        .topic-btn:hover { background-color: #4b5563; }
        .topic-btn.active { background-color: #fff; color: #111827; }
    </style>
</head>
<body class="bg-black text-white flex items-center justify-center min-h-screen p-4">

    <div class="w-full max-w-lg mx-auto bg-gray-900 rounded-2xl shadow-2xl overflow-hidden">
        
        <audio id="audioPlayer" crossOrigin="anonymous"></audio>

        <!-- Cabecera y Controles Principales -->
        <div class="p-6 bg-gray-900/80 backdrop-blur-sm border-b border-gray-800">
            <h1 class="text-2xl font-bold text-center mb-2">Selector de Clases</h1>
            <p id="currentTrackTitle" class="text-center text-gray-400 font-medium truncate h-6">Selecciona un tema para empezar</p>
            
            <div class="mt-6">
                <div id="progressBarContainer" class="progress-bar-container bg-gray-700 rounded-full h-2 cursor-pointer">
                    <div id="progressBar" class="bg-white h-2 rounded-full relative">
                        <div class="progress-bar-thumb w-4 h-4 bg-white rounded-full absolute right-0 top-1/2 -translate-y-1/2 translate-x-1/2 opacity-0 transition-opacity ring-2 ring-gray-900"></div>
                    </div>
                </div>
                <div class="flex justify-between text-xs font-mono text-gray-500 mt-2">
                    <span id="currentTime">00:00</span>
                    <span id="totalDuration">00:00</span>
                </div>
            </div>

            <div class="flex items-center justify-center space-x-6 mt-4">
                <button id="prevBtn" class="text-gray-400 hover:text-white transition-colors disabled:opacity-50"><i class="ph-fill ph-skip-back text-3xl"></i></button>
                <button id="playPauseBtn" class="bg-white text-black w-16 h-16 rounded-full flex items-center justify-center shadow-lg hover:bg-gray-200 transition-colors disabled:opacity-50"><i id="playIcon" class="ph-fill ph-play text-4xl ml-1"></i><i id="pauseIcon" class="ph-fill ph-pause text-4xl hidden"></i></button>
                <button id="nextBtn" class="text-gray-400 hover:text-white transition-colors disabled:opacity-50"><i class="ph-fill ph-skip-forward text-3xl"></i></button>
            </div>
        </div>

        <!-- Opciones de Carga, Temas y Lista de Reproducción -->
        <div class="p-6">
             <div class="grid sm:grid-cols-2 gap-4 mb-4">
                 <button id="loadTopicsBtn" class="w-full cursor-pointer bg-gray-800 hover:bg-gray-700 text-white font-bold py-3 px-4 rounded-lg flex items-center justify-center transition-colors">
                    <i id="repoIcon" class="ph-fill ph-github-logo mr-2"></i><span id="repoBtnText">Cargar Temas desde Repo</span>
                </button>
                <label for="fileInput" class="w-full cursor-pointer bg-gray-800 hover:bg-gray-700 text-white font-bold py-3 px-4 rounded-lg flex items-center justify-center transition-colors">
                    <i class="ph-fill ph-upload-simple mr-2"></i><span>Cargar Locales</span>
                </label>
             </div>
            <input type="file" id="fileInput" multiple accept="audio/*">
            
            <div id="topicsContainer" class="mb-4">
                <h2 class="text-lg font-semibold mb-2">Temas</h2>
                <div id="topicsList" class="flex flex-wrap gap-2">
                     <p id="emptyTopics" class="text-gray-500 text-sm">Presiona "Cargar Temas" para empezar.</p>
                </div>
            </div>
            
            <h2 class="text-lg font-semibold mb-2">Lista de Reproducción</h2>
            <div id="playlist" class="max-h-48 overflow-y-auto rounded-lg bg-black/50 p-2">
                <p id="emptyPlaylist" class="text-gray-500 text-center py-4">Selecciona un tema para ver los audios.</p>
            </div>
        </div>
    </div>

    <script>
        // --- Referencias al DOM ---
        const audioPlayer = document.getElementById('audioPlayer');
        const fileInput = document.getElementById('fileInput');
        const loadTopicsBtn = document.getElementById('loadTopicsBtn');
        const repoIcon = document.getElementById('repoIcon');
        const repoBtnText = document.getElementById('repoBtnText');
        const playlistElement = document.getElementById('playlist');
        const emptyPlaylistMessage = document.getElementById('emptyPlaylist');
        const topicsList = document.getElementById('topicsList');
        const emptyTopics = document.getElementById('emptyTopics');
        const currentTrackTitle = document.getElementById('currentTrackTitle');
        const currentTimeDisplay = document.getElementById('currentTime');
        const totalDurationDisplay = document.getElementById('totalDuration');
        const playPauseBtn = document.getElementById('playPauseBtn');
        const playIcon = document.getElementById('playIcon');
        const pauseIcon = document.getElementById('pauseIcon');
        const nextBtn = document.getElementById('nextBtn');
        const prevBtn = document.getElementById('prevBtn');
        const progressBarContainer = document.getElementById('progressBarContainer');
        const progressBar = document.getElementById('progressBar');

        // --- Estado de la App ---
        let playlist = [];
        let currentTrackIndex = -1;
        let isPlaying = false;
        
        // --- CONFIGURACIÓN DE GITHUB ---
        // Se han rellenado los valores con la información de tu error.
        // Asegúrate de que el repositorio sea público.
        const GITHUB_USER = "MARIO-MARTINEZ-SANFILIPPO";
        const GITHUB_REPO = "misAudios";
        const AUDIO_PATH = "AUDIOS"; // La carpeta principal que contiene las subcarpetas de temas

        // --- Lógica Principal ---
        
        /**
         * Carga la lista de temas (subcarpetas) desde el repositorio de GitHub.
         */
        async function loadTopicsFromRepo() {
            setLoadingState(loadTopicsBtn, true, "Cargando Temas...");
            topicsList.innerHTML = ''; // Limpia temas anteriores

            const apiUrl = `https://api.github.com/repos/${GITHUB_USER}/${GITHUB_REPO}/contents/${AUDIO_PATH}`;
            
            try {
                const response = await fetch(apiUrl);
                if (response.status === 404) {
                    throw new Error(`Repositorio o carpeta no encontrada. Revisa la configuración del script (usuario: ${GITHUB_USER}, repo: ${GITHUB_REPO}, carpeta: ${AUDIO_PATH})`);
                }
                if (!response.ok) {
                    throw new Error(`Error de red: ${response.statusText}`);
                }
                const items = await response.json();
                
                const topics = items.filter(item => item.type === 'dir');
                
                if (topics.length > 0) {
                    if(document.body.contains(emptyTopics)) emptyTopics.remove();
                    topics.forEach(topic => {
                        const button = document.createElement('button');
                        button.textContent = topic.name;
                        button.className = 'topic-btn text-sm font-medium py-2 px-3 rounded-lg transition-colors';
                        button.onclick = () => {
                            document.querySelectorAll('.topic-btn').forEach(btn => btn.classList.remove('active'));
                            button.classList.add('active');
                            loadAudiosFromTopic(topic.path);
                        };
                        topicsList.appendChild(button);
                    });
                } else {
                    emptyTopics.textContent = "No se encontraron temas en el repositorio.";
                    topicsList.appendChild(emptyTopics);
                }

            } catch (error) {
                console.error("Error al cargar temas desde GitHub:", error);
                emptyTopics.textContent = error.message;
                topicsList.appendChild(emptyTopics);
            } finally {
                setLoadingState(loadTopicsBtn, false, "Cargar Temas desde Repo");
            }
        }
        
        /**
         * Carga los archivos de audio de un tema (subcarpeta) específico.
         * @param {string} topicPath - La ruta completa de la carpeta del tema.
         */
        async function loadAudiosFromTopic(topicPath) {
            currentTrackTitle.textContent = 'Cargando audios...';
            playlist = [];
            renderPlaylist();

            const apiUrl = `https://api.github.com/repos/${GITHUB_USER}/${GITHUB_REPO}/contents/${topicPath}`;
            const audioExtensions = ['.wav', '.mp3', '.ogg', '.flac', '.m4a'];

            try {
                const response = await fetch(apiUrl);
                if (!response.ok) throw new Error(`Error de red: ${response.statusText}`);
                const files = await response.json();
                
                const audioFiles = files
                    .filter(file => file.type === 'file' && audioExtensions.some(ext => file.name.toLowerCase().endsWith(ext)))
                    .map(file => ({ type: 'remote', name: file.name, src: file.download_url }));

                if (audioFiles.length === 0) {
                    currentTrackTitle.textContent = "No hay audios en este tema.";
                } else {
                    playlist = audioFiles;
                    loadTrack(0, false);
                }
            } catch (error) {
                console.error("Error al cargar audios:", error);
                currentTrackTitle.textContent = "Error al cargar audios.";
            } finally {
                renderPlaylist();
            }
        }


        // --- Lógica del Reproductor ---

        function loadTrack(index, shouldPlay = false) {
            if (index < 0 || index >= playlist.length) return;
            currentTrackIndex = index;
            const trackData = playlist[index];
            
            if (trackData.type === 'local') {
                audioPlayer.src = URL.createObjectURL(trackData.file);
                currentTrackTitle.textContent = trackData.file.name;
            } else {
                audioPlayer.src = trackData.src;
                currentTrackTitle.textContent = trackData.name;
            }
            
            updateActivePlaylistItem();
            if (shouldPlay) playAudio();
        }
        
        function playAudio() {
            if (currentTrackIndex === -1 && playlist.length > 0) { loadTrack(0, true); return; }
            if (currentTrackIndex === -1) return;
            audioPlayer.play().then(() => {
                isPlaying = true;
                playIcon.classList.add('hidden');
                pauseIcon.classList.remove('hidden');
            }).catch(e => console.error("Error al reproducir:", e));
        }

        function pauseAudio() {
            isPlaying = false;
            audioPlayer.pause();
            playIcon.classList.remove('hidden');
            pauseIcon.classList.add('hidden');
        }

        function nextTrack() {
            const newIndex = playlist.length > 0 ? (currentTrackIndex + 1) % playlist.length : -1;
            if (newIndex !== -1) loadTrack(newIndex, isPlaying);
        }

        function prevTrack() {
            const newIndex = playlist.length > 0 ? (currentTrackIndex - 1 + playlist.length) % playlist.length : -1;
            if (newIndex !== -1) loadTrack(newIndex, isPlaying);
        }

        // --- Lógica de UI y Utilidades ---

        function updateProgress() {
            if (audioPlayer.duration && isFinite(audioPlayer.duration)) {
                progressBar.style.width = `${(audioPlayer.currentTime / audioPlayer.duration) * 100}%`;
                currentTimeDisplay.textContent = formatTime(audioPlayer.currentTime);
            }
        }
        
        function setProgress(e) {
            const duration = audioPlayer.duration;
            if (duration && isFinite(duration)) audioPlayer.currentTime = (e.offsetX / progressBarContainer.clientWidth) * duration;
        }

        function formatTime(seconds) {
            if (isNaN(seconds)) return '00:00';
            const min = Math.floor(seconds / 60);
            const sec = Math.floor(seconds % 60);
            return `${String(min).padStart(2, '0')}:${String(sec).padStart(2, '0')}`;
        }
        
        function renderPlaylist() {
            playlistElement.innerHTML = '';
            if (playlist.length === 0) {
                playlistElement.appendChild(emptyPlaylistMessage);
                disableControls();
                return;
            }
            enableControls();
            if(document.body.contains(emptyPlaylistMessage)) emptyPlaylistMessage.remove();
            playlist.forEach((trackData, index) => {
                const li = document.createElement('li');
                li.className = 'playlist-item p-3 rounded-md cursor-pointer';
                li.textContent = trackData.type === 'local' ? trackData.file.name : trackData.name;
                li.dataset.index = index;
                li.onclick = () => loadTrack(index, true);
                playlistElement.appendChild(li);
            });
            updateActivePlaylistItem();
        }
        
        function updateActivePlaylistItem() {
            document.querySelectorAll('.playlist-item').forEach((item) => {
                item.classList.toggle('active', parseInt(item.dataset.index) === currentTrackIndex);
            });
        }
        
        function disableControls() {
            playPauseBtn.disabled = true;
            nextBtn.disabled = true;
            prevBtn.disabled = true;
            progressBar.style.width = '0%';
            currentTimeDisplay.textContent = '00:00';
            totalDurationDisplay.textContent = '00:00';
        }
        
        function enableControls() {
             playPauseBtn.disabled = false;
             nextBtn.disabled = false;
             prevBtn.disabled = false;
        }

        function setLoadingState(button, isLoading, loadingText) {
            const icon = button.querySelector('i');
            const textSpan = button.querySelector('span');
            if (isLoading) {
                button.disabled = true;
                textSpan.textContent = loadingText;
                icon.classList.add('animate-spin');
            } else {
                button.disabled = false;
                textSpan.textContent = "Cargar Temas desde Repo";
                icon.classList.remove('animate-spin');
            }
        }
        
        // --- Event Listeners ---
        loadTopicsBtn.addEventListener('click', loadTopicsFromRepo);
        fileInput.addEventListener('change', (e) => {
            const newFiles = Array.from(e.target.files);
            if (newFiles.length === 0) return;
            playlist = newFiles.map(file => ({ type: 'local', file: file }));
            renderPlaylist();
            loadTrack(0, false);
        });
        playPauseBtn.addEventListener('click', () => isPlaying ? pauseAudio() : playAudio());
        nextBtn.addEventListener('click', nextTrack);
        prevBtn.addEventListener('click', prevTrack);
        audioPlayer.addEventListener('timeupdate', updateProgress);
        audioPlayer.addEventListener('loadedmetadata', () => {
            totalDurationDisplay.textContent = formatTime(audioPlayer.duration);
        });
        audioPlayer.addEventListener('ended', nextTrack);
        progressBarContainer.addEventListener('click', setProgress);

        // --- Inicialización ---
        disableControls();
    </script>
</body>
</html>

   

